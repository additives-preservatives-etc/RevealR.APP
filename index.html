<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Food Additive & Preservative Checker</title>

<style>
  body {
    font-family: system-ui, sans-serif;
    background:#f3f4f6;
    margin:0;
    padding:1.5rem;
  }

  .app-container {
    max-width:1100px;
    margin:0 auto;
    background:#fff;
    padding:2rem;
    border-radius:12px;
    box-shadow:0 10px 20px rgba(0,0,0,0.06);
  }

  input, button, select, textarea {
    padding:0.6rem;
    border-radius:6px;
    border:1px solid #ccc;
    width:100%;
    box-sizing:border-box;
  }

  button {
    background:#2563eb;
    color:#fff;
    font-weight:600;
    cursor:pointer;
    width:auto;
  }

  .card {
    background:#f9fafb;
    padding:1rem;
    border-radius:10px;
    border:1px solid #e5e7eb;
    margin-bottom:1rem;
  }

  .grid {
    display:grid;
    grid-template-columns: repeat(auto-fit, minmax(320px,1fr));
    gap:1.5rem;
  }

  .pill {
    display:inline-block;
    padding:0.1rem 0.4rem;
    background:#e5e7eb;
    border-radius:999px;
    margin-right:4px;
  }

  table {
    width:100%;
    border-collapse:collapse;
    margin-top:0.6rem;
  }
  th, td {
    padding:0.5rem;
    border-bottom:1px solid #e5e7eb;
    text-align:left;
    vertical-align:top;
  }
  th { background:#f3f4f6; font-weight:600; }



/* -------------------- NEW DASHBOARD STYLES -------------------- */

.dashboard-container {
  padding: 1.5rem;
  border-radius: 16px;
  margin-bottom: 2rem;
  background-color: #f9fafb; /* Neutral default */
  border: 1px solid #e5e7eb;
  transition: background-color 0.5s ease;
}

/* Color classes based on ultra-processed status */
.dashboard-container.ultra-processed {
    background-color: #fee2e2; /* Light Red */
    border-color: #f87171; /* Red border */
}

.dashboard-container.natural {
    background-color: #dcfce7; /* Light Green */
    border-color: #4ade80; /* Green border */
}

.dashboard-row {
  display: flex;
  gap: 1rem;
  flex-wrap: nowrap;
}

.dash-card {
  flex: 1;
  background: white;
  padding: 1rem;
  border-radius: 14px;
  border: 1px solid #e5e7eb;
  text-align: center;
  min-width: 180px;
}

.card-title {
  font-size: 1.1rem;
  font-weight: 600;
  margin-top: 0.3rem;
}

.card-desc {
  font-size: 0.85rem;
  color: #555;
  margin-top: 0.2rem;
}

.ring {
  width: 95px;
  height: 95px;
  margin: 0 auto;
  border-radius: 50%;
  background:
    conic-gradient(#4ade80 var(--percent, 0%), #e5e7eb 0);
  display:flex;
  align-items:center;
  justify-content:center;
  font-size: 1.5rem;
  font-weight: bold;
  color:#047857;
}

.ring.clean { background: conic-gradient(#f59e0b var(--percent, 0%), #e5e7eb 0); color:#b45309; }
.ring.seed { background: conic-gradient(#0ea5e9 var(--percent, 0%), #e5e7eb 0); color:#0369a1; }
.ring.micro { background: conic-gradient(#f87171 var(--percent, 0%), #e5e7eb 0); color:#b91c1c; }

/* Ingredient breakdown styles */
.breakdown-container {
    margin-top: 1rem;
    padding-top: 1rem;
    border-top: 1px solid #e5e7eb;
}

.breakdown-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    font-size: 0.9rem;
    margin-bottom: 0.5rem;
}

.breakdown-label {
    display: flex;
    align-items: center;
    font-weight: 600;
}

.breakdown-label::before {
    content: '';
    width: 10px;
    height: 10px;
    border-radius: 50%;
    margin-right: 8px;
}

.natural-label::before { background-color: #10b981; /* Green */ }
.artificial-label::before { background-color: #ef4444; /* Red */ }

.progress-bar-container {
    height: 8px;
    background-color: #e5e7eb;
    border-radius: 4px;
    overflow: hidden;
}

.progress-bar {
    height: 100%;
    background-color: #10b981;
    width: 0%;
    transition: width 0.5s ease;
}

</style>
</head>
<body>
<div class="app-container">

<h1>Food Additive & Preservative Checker</h1>


<!-- -------------- NEW HEALTH DASHBOARD (Updated structure) -------------- -->

<div class="dashboard-container" id="healthDashboard">
  <div style="display: flex; justify-content: space-between; align-items: center;">
    <h2>Your Health Dashboard</h2>
    <div id="processingStatus" style="font-weight: bold; padding: 0.5rem; border-radius: 8px;">Status: Unknown</div>
  </div>

  <p class="dash-sub">Overview of today's logged foods</p>

  <div class="dashboard-row">
    <!-- Existing Dash Cards remain here -->
    <div class="dash-card">
      <div class="ring" id="ringAdditive" style="--percent:0%">0</div>
      <div class="card-title">Additive Score</div>
      <div class="card-desc"><span id="additiveCount">0</span> additives logged</div>
    </div>

    <div class="dash-card">
      <div class="ring clean" id="ringClean" style="--percent:0%">0.0</div>
      <div class="card-title">Clean Score</div>
      <div class="card-desc">Avg additives per food: <span id="cleanAvg">0.00</span></div>
    </div>

    <div class="dash-card">
      <div class="ring seed" id="ringSeed" style="--percent:0%">Low</div>
      <div class="card-title">Seed Oil Risk</div>
      <div class="card-desc" id="seedDesc">No seed-oil markers detected</div>
    </div>

    <div class="dash-card">
      <div class="ring micro" id="ringMicro" style="--percent:0%">0</div>
      <div class="card-title">Microplastic Risk</div>
      <div class="card-desc"><span id="microCount">0</span> colour(s) flagged</div>
    </div>
  </div>

  <!-- Ingredient breakdown section added here -->
  <div class="breakdown-container" id="breakdownSection" style="display: none;">
    <h3>Natural vs Processed Breakdown</h3>
    <div class="breakdown-item">
      <span class="breakdown-label natural-label">Natural</span>
      <span id="naturalPercent">0%</span>
    </div>
    <div class="progress-bar-container">
      <div class="progress-bar" id="naturalProgressBar"></div>
    </div>
    <div class="breakdown-item" style="margin-top: 1rem;">
      <span class="breakdown-label artificial-label">Artificial/Processed</span>
      <span id="artificialPercent">0%</span>
    </div>
  </div>
</div>



<!-- ----------------- REST OF YOUR APP (UNCHANGED) ----------------- -->

<div class="grid">
  <div class="card">
    <h2>Add Food</h2>

    <label>Type any food you ate</label>
    <input id="foodSearch" placeholder="e.g. Big Mac, Pepsi Max, Doritos" />
    <button onclick="autoSearchFood()">Auto-detect additives using internet</button>

    <hr>

    <p>Or choose common fast foods:</p>
    <select id="fastFoodMenu">
      <option value="">-- Choose an item --</option>
      <option value="bigmac">McDonald's Big Mac</option>
      <option value="fries">Fast-food French Fries</option>
      <option value="kfc_bucket">KFC Chicken Bucket</option>
      <option value="tacobell_taco">Taco Bell Taco</option>
    </select>
    <button onclick="addFastFood()">Add fast food</button>
  </div>

  <div class="card">
    <h2>Today's Foods</h2>
    <ul id="foodsList"></ul>
    <button onclick="clearFoods()">Clear All</button>
  </div>
</div>


<div class="card" id="results">
  <h2>Daily Additive Summary</h2>

  <div id="summaryChips" style="margin-bottom:1rem; display:flex; flex-wrap:wrap; gap:0.6rem;"></div>

  <p style="font-size:0.85rem; margin-bottom:1rem;">
    Colour key:
    <span style="background:#fee2e2; color:#991b1b; padding:0.2rem 0.5rem; border-radius:12px; font-size:0.75rem;">Higher concern</span>
    <span style="background:#fef9c3; color:#854d0e; padding:0.2rem 0.5rem; border-radius:12px; font-size:0.75rem;">Some concern</span>
    <span style="background:#dcfce7; color:#166534; padding:0.2rem 0.5rem; border-radius:12px; font-size:0.75rem;">Lower concern</span>
    <span style="background:#e5e7eb; color:#374151; padding:0.2rem 0.5rem; border-radius:12px; font-size:0.75rem;">Not in this sample list</span>
  </p>

  <div id="additiveTable">No data yet.</div>
</div>


</div> <!-- end app container -->

<script>

/* ---------------- YOUR ORIGINAL DATABASE ---------------- */

const fastFoodDB = {
  bigmac:["150d","202","330","621"],
  fries:["320","450","500"],
  kfc_bucket:["621","627","631","150c"],
  tacobell_taco:["330","202","1422","621"]
};

const additiveDB = {
  "102": {name:"Tartrazine", type:"Artificial colour", concern:"high", notes:"Linked to hyperactivity and allergic reactions."},
  "110": {name:"Sunset Yellow", type:"Artificial colour", concern:"high", notes:"May trigger reactions in sensitive individuals."},
  "211": {name:"Sodium Benzoate", type:"Preservative", concern:"moderate", notes:"Can form benzene when mixed with vitamin C."},
  "220": {name:"Sulphur Dioxide", type:"Preservative (sulphite)", concern:"high", notes:"Can trigger asthma or allergies."},
  "250": {name:"Sodium Nitrite", type:"Preservative (meat)", concern:"high", notes:"Linked to nitrosamine formation (cancer risk)."},
  "621": {name:"MSG", type:"Flavour enhancer", concern:"moderate", notes:"May cause sensitivity in some people."},
  "202": {name:"Potassium Sorbate", type:"Preservative", concern:"moderate", notes:"Generally safe but may irritate skin in rare cases."},
  "330": {name:"Citric Acid", type:"Acidity regulator", concern:"low", notes:"Common and generally safe."},
  "150d": {name:"Caramel Colour", type:"Colour", concern:"moderate", notes:"May contain processing byproducts of concern."},
  "150c": {name:"Caramel Colour C", type:"Colour", concern:"moderate", notes:"Used in sauces and cola drinks."},
  "627": {name:"Disodium Guanylate", type:"Flavour enhancer", concern:"moderate", notes:"Often combined with MSG."},
  "631": {name:"Disodium Inosinate", type:"Flavour enhancer", concern:"moderate", notes:"Common in savoury snacks."},
  "320": {name:"BHA", type:"Antioxidant", concern:"moderate", notes:"Possible cancer risk in large amounts."},
  "450": {name:"Diphosphates", type:"Stabiliser", concern:"low", notes:"Generally recognised as safe."},
  "500": {name:"Bicarbonates", type:"Raising agent", concern:"low", notes:"Common leavening agent."},
  "1422": {name:"Modified Starch", type:"Thickener", concern:"low", notes:"Common in processed foods."},
  "150": {name:"Caramel (generic)", type:"Colour", concern:"moderate", notes:"Generic caramel colour."}
};

let foods = [];


/* ---------------- RENDER UPDATED DASHBOARD RINGS AND STATUS ---------------- */

function updateDashboard() {
  const totalAdditives = foods.reduce((sum, f) => sum + f.additives.length, 0);
  const cleanScore = foods.length ? (totalAdditives / foods.length) : 0;
  
  const totalHomemadeScore = foods.reduce((sum, f) => sum + (f.isHomemade ? 1 : 0), 0);
  const homemadePercentage = foods.length ? Math.round((totalHomemadeScore / foods.length) * 100) : 0;

  document.getElementById('additiveCount').textContent = totalAdditives;
  document.getElementById('ringAdditive').style.setProperty('--percent', `${Math.min(totalAdditives * 10, 100)}%`);
  document.getElementById('cleanAvg').textContent = cleanScore.toFixed(2);

  const dashboardContainer = document.getElementById('healthDashboard');
  const processingStatusEl = document.getElementById('processingStatus');
  const breakdownSection = document.getElementById('breakdownSection');
  const naturalProgressBar = document.getElementById('naturalProgressBar');

  if (foods.length === 0) {
      dashboardContainer.className = 'dashboard-container';
      processingStatusEl.textContent = 'Status: Unknown';
      processingStatusEl.style.backgroundColor = 'transparent';
      breakdownSection.style.display = 'none';
  } else {
      if (homemadePercentage >= 50) {
          dashboardContainer.classList.remove('ultra-processed');
          dashboardContainer.classList.add('natural');
          processingStatusEl.textContent = 'Status: Mostly Natural';
          processingStatusEl.style.backgroundColor = '#ecfdf5';
      } else {
          dashboardContainer.classList.remove('natural');
          dashboardContainer.classList.add('ultra-processed');
          processingStatusEl.textContent = 'Status: Mostly Ultra-Processed';
          processingStatusEl.style.backgroundColor = '#fef2f2';
      }

      breakdownSection.style.display = 'block';
      const naturalP = homemadePercentage;
      const artificialP = 100 - homemadePercentage;

      document.getElementById('naturalPercent').textContent = `${naturalP}%`;
      document.getElementById('artificialPercent').textContent = `${artificialP}%`;
      naturalProgressBar.style.width = `${naturalP}%`;

      if (artificialP >= 60) {
          naturalProgressBar.style.backgroundColor = '#ef4444';
      } else {
          naturalProgressBar.style.backgroundColor = '#10b981';
      }
  }
}


/* ---------------- CORE LOGIC MODIFIED HERE ---------------- */


function promptForHomemade(foodName) {
    const isHomemade = confirm(`Is the food "${foodName}" homemade? Click OK for YES, Cancel for NO.`);
    return isHomemade;
}

// Function modified to handle additives based on homemade status
function addFood(name, additives, isHomemade = undefined) {
  let homemadeStatus = isHomemade;
  
  if (homemadeStatus === undefined) {
      homemadeStatus = promptForHomemade(name);
  }

  // CRITICAL CHANGE: If homemade, the final additives list stored is empty.
  const finalAdditives = (homemadeStatus === true) ? [] : additives;

  foods.push({ name, additives: finalAdditives, isHomemade: homemadeStatus });
  renderFoods();
  updateDashboard();
}

function autoSearchFood() {
  const searchInput = document.getElementById('foodSearch');
  const foodName = searchInput.value.trim();
  if (foodName) {
    const simulatedAdditives = ["621", "150d", "202"]; 
    // Calling addFood without 3rd argument triggers prompt, and uses the simulated list
    addFood(foodName, simulatedAdditives);
    searchInput.value = '';
  }
}

function addFastFood() {
  const menu = document.getElementById('fastFoodMenu');
  const selectedFoodKey = menu.value;
  if (selectedFoodKey) {
    const additives = fastFoodDB[selectedFoodKey];
    const foodName = menu.options[menu.selectedIndex].text;
    // Pass 'false' explicitly for fast food to skip the pop-up prompt AND use the DB additives
    addFood(foodName, additives, false); 
    menu.value = '';
  }
}

function clearFoods() {
  foods = [];
  renderFoods();
  updateDashboard();
}

function removeFood(index) {
  foods.splice(index, 1);
  renderFoods();
  updateDashboard();
}

function renderFoods() {
  const foodsList = document.getElementById('foodsList');
  foodsList.innerHTML = '';
  foods.forEach((food, index) => {
    const li = document.createElement('li');
    // food.additives.length will now correctly show 0 for homemade items
    li.innerHTML = `${food.name} (${food.additives.length} additives) 
                    <span class="pill">${food.isHomemade ? 'Homemade ✅' : 'Processed ❌'}</span>
                    <button onclick="removeFood(${index})" style="width: auto; margin-left: 10px;">Remove</button>`;
    foodsList.appendChild(li);
  });
  renderAdditiveSummary();
}


/* ---------------- SUMMARY SECTION FUNCTIONS ---------------- */

function renderAdditiveSummary() {
  const additiveTableEl = document.getElementById('additiveTable');
  const summaryChipsEl = document.getElementById('summaryChips');
  
  if (foods.length === 0) {
    additiveTableEl.innerHTML = 'No data yet.';
    summaryChipsEl.innerHTML = '';
    return;
  }

  // Gather unique additives from all *non-empty* additive lists logged
  const allAdditives = foods.flatMap(food => food.additives);
  const uniqueAdditives = [...new Set(allAdditives)].sort();

  if (uniqueAdditives.length === 0) {
      additiveTableEl.innerHTML = '<p>No artificial additives detected in today\'s log.</p>';
      summaryChipsEl.innerHTML = '';
      return;
  }

  let tableHTML = `
    <table>
      <thead>
        <tr>
          <th>Code</th>
          <th>Name</th>
          <th>Type</th>
          <th>Concern Level</th>
          <th>Notes</th>
        </tr>
      </thead>
      <tbody>
  `;

  uniqueAdditives.forEach(code => {
    const details = additiveDB[code];
    if (details) {
      let concernClass = '';
      if (details.concern === 'high') concernClass = 'style="background:#fee2e2; color:#991b1b;"';
      if (details.concern === 'moderate') concernClass = 'style="background:#fef9c3; color:#854d0e;"';
      if (details.concern === 'low') concernClass = 'style="background:#dcfce7; color:#166534;"';

      tableHTML += `
        <tr>
          <td><strong>${code}</strong></td>
          <td>${details.name}</td>
          <td>${details.type}</td>
          <td ${concernClass}>${details.concern}</td>
          <td>${details.notes}</td>
        </tr>
      `;
      
      const chip = document.createElement('span');
      chip.className = 'pill';
      chip.textContent = code;
      summaryChipsEl.appendChild(chip);

    }
  });

  tableHTML += `</tbody></table>`;
  additiveTableEl.innerHTML = tableHTML;
}

// Initial dashboard update on load
updateDashboard();

</script>
</body>
</html>
